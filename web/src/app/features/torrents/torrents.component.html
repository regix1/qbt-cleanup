<div class="page-container">
  <div class="page-header">
    <h2>Torrents</h2>
    <p-button label="Refresh" icon="pi pi-refresh" (onClick)="loadTorrents()" />
  </div>

  @if (loading()) {
    <div class="loading-container">
      <p-progressSpinner strokeWidth="4" />
    </div>
  } @else {
    <div class="table-container">
      <p-table #dt
               [value]="torrents()"
               [paginator]="true"
               [rows]="25"
               [rowsPerPageOptions]="[25, 50, 100]"
               [globalFilterFields]="['name', 'state', 'category']"
               [rowHover]="true"
               styleClass="torrents-table">

        <ng-template #caption>
          <div class="table-header">
            <p-iconfield>
              <p-inputicon styleClass="pi pi-search" />
              <input pInputText type="text"
                     (input)="onFilter($event, dt)"
                     placeholder="Filter by name, state, category..." />
            </p-iconfield>
          </div>
        </ng-template>

        <ng-template #header>
          <tr>
            <th pSortableColumn="name">Name <p-sortIcon field="name" /></th>
            <th pSortableColumn="state">State <p-sortIcon field="state" /></th>
            <th pSortableColumn="ratio">Ratio <p-sortIcon field="ratio" /></th>
            <th pSortableColumn="seeding_time">Seeding Time <p-sortIcon field="seeding_time" /></th>
            <th pSortableColumn="is_private">Type <p-sortIcon field="is_private" /></th>
            <th pSortableColumn="size">Size <p-sortIcon field="size" /></th>
            <th pSortableColumn="progress">Progress <p-sortIcon field="progress" /></th>
            <th pSortableColumn="is_blacklisted">Blacklisted <p-sortIcon field="is_blacklisted" /></th>
            <th>Actions</th>
          </tr>
        </ng-template>

        <ng-template #body let-torrent>
          <tr [class.blacklisted-row]="torrent.is_blacklisted" class="torrent-row">
            <td class="name-cell">
              <span [pTooltip]="torrent.name" tooltipPosition="top">{{ torrent.name }}</span>
            </td>
            <td>
              <span class="state-badge" [ngClass]="getStateColor(torrent.state)">
                {{ getStateLabel(torrent.state) }}
              </span>
            </td>
            <td>{{ torrent.ratio | number:'1.2-2' }}</td>
            <td>{{ formatSeedingTime(torrent.seeding_time) }}</td>
            <td>
              @if (torrent.is_private) {
                <span class="type-badge private">Private</span>
              } @else {
                <span class="type-badge public">Public</span>
              }
            </td>
            <td>{{ formatSize(torrent.size) }}</td>
            <td>{{ formatProgress(torrent.progress) }}</td>
            <td>
              @if (torrent.is_blacklisted) {
                <i class="pi pi-shield blacklisted-icon"></i>
              }
            </td>
            <td>
              <p-button [rounded]="true"
                        [text]="true"
                        [pTooltip]="torrent.is_blacklisted ? 'Remove from blacklist' : 'Add to blacklist'"
                        tooltipPosition="top"
                        [icon]="torrent.is_blacklisted ? 'pi pi-minus-circle' : 'pi pi-plus-circle'"
                        (onClick)="toggleBlacklist(torrent)" />
            </td>
          </tr>
        </ng-template>

        <ng-template #emptymessage>
          <tr>
            <td colspan="9" class="no-data-cell">
              No torrents found
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  }
</div>
