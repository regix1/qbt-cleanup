<div class="page-container">
  <div class="page-header">
    <h2>Dashboard</h2>
    <div class="header-actions">
      <p-button label="Run Scan"
                icon="pi pi-play"
                (onClick)="runScan()"
                [disabled]="scanning()"
                [loading]="scanning()" />
      <p-button label="Orphaned Scan"
                icon="pi pi-folder"
                severity="secondary"
                (onClick)="runOrphanedScan()"
                [disabled]="orphanScanning()"
                [loading]="orphanScanning()" />
    </div>
  </div>

  @if (loading()) {
    <div class="loading-container">
      <p-progressSpinner strokeWidth="4" />
    </div>
  } @else if (status(); as s) {
    <div class="card-grid">
      <p-card styleClass="stat-card">
        <i class="pi pi-download stat-icon" style="color: var(--accent-blue)"></i>
        <span class="stat-value">{{ s.torrent_count }}</span>
        <span class="stat-label">Total Torrents</span>
      </p-card>

      <p-card styleClass="stat-card">
        <i class="pi pi-lock stat-icon" style="color: var(--accent-purple)"></i>
        <span class="stat-value">{{ s.private_count }}</span>
        <span class="stat-label">Private</span>
      </p-card>

      <p-card styleClass="stat-card">
        <i class="pi pi-globe stat-icon" style="color: var(--accent-green)"></i>
        <span class="stat-value">{{ s.public_count }}</span>
        <span class="stat-label">Public</span>
      </p-card>

      <p-card styleClass="stat-card">
        <i class="pi pi-exclamation-triangle stat-icon" style="color: var(--accent-orange)"></i>
        <span class="stat-value">{{ s.stalled_count }}</span>
        <span class="stat-label">Stalled</span>
      </p-card>

      <p-card styleClass="stat-card">
        <i class="pi pi-ban stat-icon" style="color: var(--accent-red)"></i>
        <span class="stat-value">{{ s.blacklist_count }}</span>
        <span class="stat-label">Blacklisted</span>
      </p-card>
    </div>

    <div class="info-grid">
      <p-card styleClass="section-card">
        <ng-template #header>
          <div class="card-header-content">
            <i class="pi pi-history"></i>
            <span>Last Run</span>
          </div>
        </ng-template>
        <div class="info-row">
          <span class="info-label">Time</span>
          <span class="info-value">{{ formatDate(s.last_run_time) }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Result</span>
          @if (s.last_run_success === null) {
            <span class="status-chip info">No runs yet</span>
          } @else if (s.last_run_success) {
            <span class="status-chip success">Success</span>
          } @else {
            <span class="status-chip error">Failed</span>
          }
        </div>
        @if (s.last_run_stats) {
          <p-divider />
          <div class="stats-grid">
            <div class="mini-stat">
              <span class="mini-value">{{ s.last_run_stats.total_checked }}</span>
              <span class="mini-label">Checked</span>
            </div>
            <div class="mini-stat">
              <span class="mini-value">{{ s.last_run_stats.total_removed }}</span>
              <span class="mini-label">Removed</span>
            </div>
            <div class="mini-stat">
              <span class="mini-value">{{ s.last_run_stats.private_removed }}</span>
              <span class="mini-label">Private Rem.</span>
            </div>
            <div class="mini-stat">
              <span class="mini-value">{{ s.last_run_stats.public_removed }}</span>
              <span class="mini-label">Public Rem.</span>
            </div>
            <div class="mini-stat">
              <span class="mini-value">{{ s.last_run_stats.blacklisted_skipped }}</span>
              <span class="mini-label">Skipped</span>
            </div>
            <div class="mini-stat">
              <span class="mini-value">{{ s.last_run_stats.errors }}</span>
              <span class="mini-label">Errors</span>
            </div>
          </div>
        }
      </p-card>

      <p-card styleClass="section-card">
        <ng-template #header>
          <div class="card-header-content">
            <i class="pi pi-clock"></i>
            <span>Scheduler</span>
          </div>
        </ng-template>
        <div class="info-row">
          <span class="info-label">Status</span>
          @if (s.scheduler_running) {
            <span class="status-chip success">Running</span>
          } @else {
            <span class="status-chip warning">Stopped</span>
          }
        </div>
        <div class="info-row">
          <span class="info-label">Interval</span>
          <span class="info-value">Every {{ s.schedule_hours }} hours</span>
        </div>
      </p-card>

      <p-card styleClass="section-card">
        <ng-template #header>
          <div class="card-header-content">
            <i class="pi pi-sliders-h"></i>
            <span>Behavior</span>
          </div>
        </ng-template>
        <div class="info-row">
          <span class="info-label">Dry Run</span>
          @if (s.dry_run) {
            <span class="status-chip warning">Enabled</span>
          } @else {
            <span class="status-chip success">Disabled</span>
          }
        </div>
        <div class="info-row">
          <span class="info-label">Delete Files</span>
          @if (s.delete_files) {
            <span class="status-chip error">Enabled</span>
          } @else {
            <span class="status-chip info">Disabled</span>
          }
        </div>
      </p-card>
    </div>
  }
</div>
