<div class="page-container">
  <div class="page-header">
    <h2>Dashboard</h2>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="runScan()" [disabled]="scanning()">
        @if (scanning()) {
          <i class="fa-solid fa-spinner fa-spin"></i>
        } @else {
          <i class="fa-solid fa-play"></i>
        }
        <span>Run Scan</span>
      </button>
      <button class="btn btn-secondary" (click)="runOrphanedScan()" [disabled]="orphanScanning()">
        @if (orphanScanning()) {
          <i class="fa-solid fa-spinner fa-spin"></i>
        } @else {
          <i class="fa-solid fa-folder"></i>
        }
        <span>Orphaned Scan</span>
      </button>
    </div>
  </div>

  @if (loading()) {
    <app-loading-container />
  } @else if (status(); as s) {
    <div class="card-grid">
      <div class="stat-card">
        <i class="fa-solid fa-download stat-icon" style="color: var(--accent-yellow)"></i>
        <span class="stat-value">{{ s.torrent_count }}</span>
        <span class="stat-label">Total Torrents</span>
      </div>

      <div class="stat-card">
        <i class="fa-solid fa-lock stat-icon" style="color: var(--accent-gold)"></i>
        <span class="stat-value">{{ s.private_count }}</span>
        <span class="stat-label">Private</span>
      </div>

      <div class="stat-card">
        <i class="fa-solid fa-globe stat-icon" style="color: var(--accent-yellow)"></i>
        <span class="stat-value">{{ s.public_count }}</span>
        <span class="stat-label">Public</span>
      </div>

      <div class="stat-card">
        <i class="fa-solid fa-triangle-exclamation stat-icon" style="color: var(--accent-amber)"></i>
        <span class="stat-value">{{ s.stalled_count }}</span>
        <span class="stat-label">Stalled</span>
      </div>

      <div class="stat-card">
        <i class="fa-solid fa-ban stat-icon" style="color: var(--accent-copper)"></i>
        <span class="stat-value">{{ s.blacklist_count }}</span>
        <span class="stat-label">Blacklisted</span>
      </div>
    </div>

    <div class="info-grid">
      <div class="section-card">
        <div class="card-header-content">
          <i class="fa-solid fa-clock-rotate-left"></i>
          <span>Last Run</span>
        </div>
        <div class="card-body">
          <div class="info-row">
            <span class="info-label">Time</span>
            <span class="info-value">{{ formatDate(s.last_run_time) }}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Result</span>
            @if (s.last_run_success === null) {
              <span class="status-chip info">No runs yet</span>
            } @else if (s.last_run_success) {
              <span class="status-chip success">Success</span>
            } @else {
              <span class="status-chip error">Failed</span>
            }
          </div>
          @if (s.last_run_stats) {
            <hr class="divider">
            <div class="stats-grid">
              <div class="mini-stat">
                <span class="mini-value">{{ s.last_run_stats.total_checked }}</span>
                <span class="mini-label">Checked</span>
              </div>
              <div class="mini-stat">
                <span class="mini-value">{{ s.last_run_stats.total_removed }}</span>
                <span class="mini-label">Removed</span>
              </div>
              <div class="mini-stat">
                <span class="mini-value">{{ s.last_run_stats.private_removed }}</span>
                <span class="mini-label">Private Rem.</span>
              </div>
              <div class="mini-stat">
                <span class="mini-value">{{ s.last_run_stats.public_removed }}</span>
                <span class="mini-label">Public Rem.</span>
              </div>
              <div class="mini-stat">
                <span class="mini-value">{{ s.last_run_stats.blacklisted_skipped }}</span>
                <span class="mini-label">Skipped</span>
              </div>
              <div class="mini-stat">
                <span class="mini-value">{{ s.last_run_stats.errors }}</span>
                <span class="mini-label">Errors</span>
              </div>
            </div>
          }
        </div>
      </div>

      <div class="section-card">
        <div class="card-header-content">
          <i class="fa-solid fa-clock"></i>
          <span>Scheduler</span>
        </div>
        <div class="card-body">
          <div class="info-row">
            <span class="info-label">Status</span>
            @if (s.scheduler_running) {
              <span class="status-chip success">Running</span>
            } @else {
              <span class="status-chip inactive">Stopped</span>
            }
          </div>
          <div class="info-row">
            <span class="info-label">Interval</span>
            <span class="info-value">Every {{ s.schedule_hours }} hours</span>
          </div>
        </div>
      </div>

      <div class="section-card">
        <div class="card-header-content">
          <i class="fa-solid fa-sliders"></i>
          <span>Behavior</span>
        </div>
        <div class="card-body">
          <div class="info-row">
            <span class="info-label">Dry Run</span>
            @if (s.dry_run) {
              <span class="status-chip success">Enabled</span>
            } @else {
              <span class="status-chip inactive">Disabled</span>
            }
          </div>
          <div class="info-row">
            <span class="info-label">Delete Files</span>
            @if (s.delete_files) {
              <span class="status-chip warning">Enabled</span>
            } @else {
              <span class="status-chip inactive">Disabled</span>
            }
          </div>
        </div>
      </div>
    </div>
  }
</div>
