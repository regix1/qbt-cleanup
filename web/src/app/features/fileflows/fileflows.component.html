<div class="page-container">
  <div class="page-header">
    <h2>FileFlows Integration</h2>
    <button mat-raised-button (click)="loadStatus()">
      <mat-icon>refresh</mat-icon>
      Refresh
    </button>
  </div>

  @if (loading()) {
    <div class="loading-container">
      <mat-spinner diameter="48"></mat-spinner>
    </div>
  } @else if (error()) {
    <mat-card class="section-card error-card">
      <mat-card-content>
        <div class="error-content">
          <mat-icon class="error-icon">error_outline</mat-icon>
          <h3>Unable to connect to FileFlows</h3>
          <p>The FileFlows status endpoint is not available. Make sure FileFlows integration is configured.</p>
          <button mat-raised-button color="primary" (click)="loadStatus()">
            <mat-icon>refresh</mat-icon>
            Retry
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  } @else if (status(); as s) {
    <div class="card-grid">
      <mat-card class="stat-card">
        <mat-card-content>
          <mat-icon class="stat-icon" [style.color]="s.enabled ? 'var(--accent-green)' : 'var(--accent-red)'">
            {{ s.enabled ? 'toggle_on' : 'toggle_off' }}
          </mat-icon>
          <span class="stat-value">{{ s.enabled ? 'Enabled' : 'Disabled' }}</span>
          <span class="stat-label">Integration</span>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <mat-icon class="stat-icon" [style.color]="s.connected ? 'var(--accent-green)' : 'var(--accent-red)'">
            {{ s.connected ? 'cloud_done' : 'cloud_off' }}
          </mat-icon>
          <span class="stat-value">{{ s.connected ? 'Connected' : 'Disconnected' }}</span>
          <span class="stat-label">Connection</span>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <mat-icon class="stat-icon" style="color: var(--accent-blue)">engineering</mat-icon>
          <span class="stat-value">{{ s.processing }}</span>
          <span class="stat-label">Processing</span>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <mat-icon class="stat-icon" style="color: var(--accent-orange)">queue</mat-icon>
          <span class="stat-value">{{ s.queue }}</span>
          <span class="stat-label">Queue</span>
        </mat-card-content>
      </mat-card>
    </div>

    @if (s.processing_files && s.processing_files.length > 0) {
      <mat-card class="section-card">
        <mat-card-header>
          <mat-icon mat-card-avatar>description</mat-icon>
          <mat-card-title>Currently Processing</mat-card-title>
          <mat-card-subtitle>{{ s.processing_files.length }} file(s) being processed</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <mat-list>
            @for (file of s.processing_files; track file) {
              <mat-list-item>
                <mat-icon matListItemIcon>insert_drive_file</mat-icon>
                <span matListItemTitle class="file-name">{{ getFileName(file) }}</span>
                <span matListItemLine class="file-path">{{ file }}</span>
              </mat-list-item>
            }
          </mat-list>
        </mat-card-content>
      </mat-card>
    } @else if (s.connected) {
      <mat-card class="section-card">
        <mat-card-content>
          <div class="empty-state">
            <mat-icon>check_circle</mat-icon>
            <p>No files currently being processed</p>
          </div>
        </mat-card-content>
      </mat-card>
    }
  }
</div>
