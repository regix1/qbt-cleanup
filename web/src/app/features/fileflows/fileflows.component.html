<div class="page-container">
  <div class="page-header">
    <div class="header-title-group">
      <h2>FileFlows Integration</h2>
      <button class="btn btn-secondary btn-sm" (click)="loadStatus()">
        <i class="fa-solid fa-arrows-rotate"></i>
        <span>Refresh</span>
      </button>
    </div>
  </div>

  @if (loading()) {
    <app-loading-container />
  } @else if (error()) {
    <div class="section-card error-card">
      <div class="error-content">
        <i class="fa-solid fa-circle-xmark error-icon"></i>
        <h3>Unable to connect to FileFlows</h3>
        <p>The FileFlows status endpoint is not available. Make sure FileFlows integration is configured.</p>
        <button class="btn btn-primary" (click)="loadStatus()">
          <i class="fa-solid fa-arrows-rotate"></i>
          <span>Retry</span>
        </button>
      </div>
    </div>
  } @else if (status(); as s) {
    <div class="card-grid">
      <div class="stat-card">
        <i class="fa-solid fa-power-off stat-icon" [class.icon-active]="s.enabled" [class.icon-inactive]="!s.enabled"></i>
        <span class="stat-value">{{ s.enabled ? 'Enabled' : 'Disabled' }}</span>
        <span class="stat-label">Integration</span>
      </div>

      <div class="stat-card">
        <i class="fa-solid fa-cloud stat-icon" [class.icon-active]="s.connected" [class.icon-inactive]="!s.connected"></i>
        <span class="stat-value">{{ s.connected ? 'Connected' : 'Disconnected' }}</span>
        <span class="stat-label">Connection</span>
      </div>

      <div class="stat-card">
        <i class="fa-solid fa-wrench stat-icon icon-active"></i>
        <span class="stat-value">{{ s.processing }}</span>
        <span class="stat-label">Processing</span>
      </div>

      <div class="stat-card">
        <i class="fa-solid fa-list stat-icon icon-amber"></i>
        <span class="stat-value">{{ s.queue }}</span>
        <span class="stat-label">Queue</span>
      </div>
    </div>

    @if (s.processing_files && s.processing_files.length > 0) {
      <div class="section-card">
        <div class="card-header-content">
          <i class="fa-solid fa-file-pen"></i>
          <div>
            <span class="card-title">Currently Processing</span>
            <span class="card-subtitle">{{ s.processing_files.length }} file(s) being processed</span>
          </div>
        </div>
        <div class="card-body">
          <ul class="file-list">
            @for (file of s.processing_files; track file.name) {
              <li class="file-item">
                <i class="fa-solid fa-file"></i>
                <div>
                  <span class="file-name">{{ getFileName(file) }}</span>
                  <span class="file-path">{{ getFilePath(file) }}</span>
                </div>
              </li>
            }
          </ul>
        </div>
      </div>
    } @else if (s.connected) {
      <div class="section-card">
        <div class="empty-state">
          <i class="fa-solid fa-circle-check"></i>
          <p>No files currently being processed</p>
        </div>
      </div>
    }
  }
</div>
