<div class="page-container">
  <div class="page-header">
    <h2>Blacklist</h2>
    <div class="header-actions">
      <p-button (click)="loadBlacklist()" icon="pi pi-refresh" label="Refresh" />
      <p-button severity="danger"
                (click)="clearAll()"
                [disabled]="entries().length === 0"
                icon="pi pi-trash"
                label="Clear All" />
    </div>
  </div>

  <p-card class="section-card add-form-card">
    <ng-template #header>
      <div class="card-header-content">
        <i class="pi pi-plus-circle" style="color: var(--accent-blue)"></i>
        <span>Add to Blacklist</span>
      </div>
    </ng-template>
    <div class="add-form">
      <p-floatlabel>
        <input pInputText id="hash" [ngModel]="newHash()" (ngModelChange)="newHash.set($event)" />
        <label for="hash">Torrent Hash</label>
      </p-floatlabel>

      <p-floatlabel>
        <input pInputText id="name" [ngModel]="newName()" (ngModelChange)="newName.set($event)" />
        <label for="name">Name (optional)</label>
      </p-floatlabel>

      <p-floatlabel>
        <input pInputText id="reason" [ngModel]="newReason()" (ngModelChange)="newReason.set($event)" />
        <label for="reason">Reason (optional)</label>
      </p-floatlabel>

      <p-button severity="primary"
                (click)="addEntry()"
                [disabled]="!canAdd()"
                icon="pi pi-plus"
                label="Add Entry" />
    </div>
  </p-card>

  @if (loading()) {
    <div class="loading-container">
      <p-progressSpinner [style]="{width: '48px', height: '48px'}" />
    </div>
  } @else {
    <div class="table-container">
      <p-table [value]="entries()" styleClass="blacklist-table">
        <ng-template #header>
          <tr>
            <th>Name</th>
            <th>Hash</th>
            <th>Reason</th>
            <th>Added</th>
            <th>Actions</th>
          </tr>
        </ng-template>
        <ng-template #body let-entry>
          <tr>
            <td class="name-cell">
              <span [pTooltip]="entry.name">{{ entry.name || '--' }}</span>
            </td>
            <td>
              <span class="hash-cell" [pTooltip]="entry.hash">{{ truncateHash(entry.hash) }}</span>
            </td>
            <td>{{ entry.reason || '--' }}</td>
            <td>{{ formatDate(entry.added_at) }}</td>
            <td>
              <p-button icon="pi pi-trash"
                        severity="danger"
                        [rounded]="true"
                        [text]="true"
                        pTooltip="Remove from blacklist"
                        (click)="removeEntry(entry)" />
            </td>
          </tr>
        </ng-template>
        <ng-template #emptymessage>
          <tr>
            <td colspan="5" class="no-data-cell">Blacklist is empty</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  }
</div>
