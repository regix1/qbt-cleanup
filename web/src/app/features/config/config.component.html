<div class="page-container">
  <div class="page-header">
    <h2>Configuration</h2>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="loadConfig()">
        <i class="fa-solid fa-arrows-rotate"></i>
        <span>Reload</span>
      </button>
      <button class="btn btn-primary"
              (click)="saveConfig()"
              [disabled]="!hasModifications() || saving()">
        @if (saving()) {
          <i class="fa-solid fa-spinner fa-spin"></i>
        } @else {
          <i class="fa-solid fa-floppy-disk"></i>
        }
        <span>Save Changes</span>
      </button>
    </div>
  </div>

  @if (loading()) {
    <div class="loading-container">
      <div class="spinner"></div>
    </div>
  } @else {
    <div class="accordion">
      @for (section of sections(); track section.key) {
        <div class="accordion-panel" [class.accordion-panel-open]="section.expanded">
          <div class="accordion-header" (click)="toggleSection(section)">
            <i [class]="section.icon + ' section-icon'"></i>
            <span class="section-name">{{ section.name }}</span>
            @if (sectionHasModifications(section)) {
              <span class="modified-badge">Modified</span>
            }
            <span class="spacer"></span>
            <span class="section-count">{{ section.fields.length }} settings</span>
            <i class="fa-solid fa-chevron-down accordion-chevron"></i>
          </div>
          @if (section.expanded) {
            <div class="accordion-content">
              <div class="fields-grid">
                @for (field of section.fields; track field.key) {
                  <div class="field-row" [class.field-modified]="field.modified">
                    <div class="field-info">
                      <span class="field-name">{{ formatFieldName(field.key) }}</span>
                      <span class="field-key">{{ field.key }}</span>
                    </div>

                    <div class="field-input">
                      @if (field.type === 'boolean') {
                        <div class="toggle-row">
                          <label class="toggle-switch">
                            <input type="checkbox"
                                   [(ngModel)]="field.editValue"
                                   (ngModelChange)="onFieldChange(section, field)">
                            <span class="toggle-slider"></span>
                          </label>
                          <span class="toggle-label">{{ field.editValue ? 'Enabled' : 'Disabled' }}</span>
                        </div>
                      } @else if (field.type === 'number') {
                        <input class="form-input" type="number"
                               [(ngModel)]="field.editValue"
                               (ngModelChange)="onFieldChange(section, field)">
                      } @else {
                        <input class="form-input" type="text"
                               [(ngModel)]="field.editValue"
                               (ngModelChange)="onFieldChange(section, field)">
                      }
                    </div>

                    <div class="field-actions">
                      @if (field.modified) {
                        <button class="btn-icon" title="Reset to original value" (click)="resetField(field)">
                          <i class="fa-solid fa-rotate-left"></i>
                        </button>
                      }
                    </div>
                  </div>
                }
              </div>
            </div>
          }
        </div>
      }
    </div>
  }
</div>
